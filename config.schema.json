{
  "pluginAlias": "BlinkCameras",
  "pluginType": "platform",
  "singular": true,
  "customUi": true,
  "customUiPath": "./dist/homebridge-ui",
  "headerDisplay": "Blink cameras integration for HomeKit via Homebridge. Provides SecuritySystem arm/disarm, motion sensors, and doorbell notifications.",
  "footerDisplay": "For help, see the [README](https://github.com/sealad886/homebridge-blink-cameras-new-api#readme).",
  "schema": {
    "type": "object",
    "properties": {
      "name": {
        "title": "Platform Name",
        "description": "Name for this Blink platform instance",
        "type": "string",
        "default": "Blink",
        "required": true
      },
      "deviceId": {
        "title": "Device ID",
        "description": "Unique identifier for this Homebridge instance (sent to Blink as hardware_id)",
        "type": "string",
        "default": "homebridge-blink",
        "required": false
      },
      "deviceName": {
        "title": "Device Name",
        "description": "Friendly name for this device (fallback for Device ID)",
        "type": "string",
        "required": false
      },
      "tier": {
        "title": "Blink Region",
        "description": "Blink API region. Use 'Production' for most users. The plugin auto-discovers the correct endpoint after first login.",
        "type": "string",
        "default": "prod",
        "required": false,
        "oneOf": [
          { "title": "Production (Default)", "enum": ["prod"] },
          { "title": "Europe (EU)", "enum": ["prde"] },
          { "title": "Asia Pacific (APAC)", "enum": ["prsg"] },
          { "title": "Australia (AU)", "enum": ["a001"] },
          { "title": "Production (e001)", "enum": ["e001"] },
          { "title": "Production (e002)", "enum": ["e002"] },
          { "title": "Production (e003)", "enum": ["e003"] },
          { "title": "Production (e004)", "enum": ["e004"] },
          { "title": "Production (e005)", "enum": ["e005"] },
          { "title": "Production (e006)", "enum": ["e006"] }
        ]
      },
      "persistAuth": {
        "title": "Persist Auth Tokens",
        "description": "Persist OAuth tokens across restarts to avoid repeated logins and verification prompts.",
        "type": "boolean",
        "default": true,
        "required": false
      },
      "trustDevice": {
        "title": "Trust This Device",
        "description": "Mark this Homebridge instance as a trusted device during client verification.",
        "type": "boolean",
        "default": true,
        "required": false
      },
      "authLocked": {
        "title": "Lock Authentication",
        "description": "Lock authentication state after successful login. When locked, stored verification codes are ignored and only token refresh is used. Unlock to force re-authentication.",
        "type": "boolean",
        "default": false,
        "required": false
      },
      "debugAuth": {
        "title": "Debug Authentication",
        "description": "Enable verbose diagnostic logging for Blink API authentication. WARNING: May log sensitive request details.",
        "type": "boolean",
        "default": false,
        "required": false
      },
      "pollInterval": {
        "title": "Poll Interval (seconds)",
        "description": "How often to poll Blink for state changes. Minimum 15 seconds.",
        "type": "integer",
        "default": 60,
        "minimum": 15,
        "maximum": 600,
        "required": false
      },
      "motionTimeout": {
        "title": "Motion Timeout (seconds)",
        "description": "How long motion detected state stays active before resetting",
        "type": "integer",
        "default": 30,
        "minimum": 5,
        "maximum": 300,
        "required": false
      },
      "enableMotionPolling": {
        "title": "Enable Motion Detection",
        "description": "Poll for motion events via media API. Disable to reduce API calls.",
        "type": "boolean",
        "default": true,
        "required": false
      },
      "snapshotCacheTTL": {
        "title": "Snapshot Cache Duration (seconds)",
        "description": "How long to cache camera snapshots before requesting a fresh one from Blink. Set to 0 to always request fresh snapshots (uses more battery). Default: 60 seconds.",
        "type": "integer",
        "default": 60,
        "minimum": 0,
        "maximum": 300,
        "required": false
      },
      "persistSnapshotCache": {
        "title": "Persist Snapshot Cache Until Manual Refresh",
        "description": "Keep the last successful snapshot indefinitely instead of expiring by TTL. When enabled, each camera exposes a 'Refresh Snapshot' switch in Home to fetch a new thumbnail on demand.",
        "type": "boolean",
        "default": false,
        "required": false
      },
      "enableStreaming": {
        "title": "Enable Live Streaming",
        "description": "Enable HomeKit live video streaming via FFmpeg.",
        "type": "boolean",
        "default": true,
        "required": false
      },
      "ffmpegPath": {
        "title": "FFmpeg Path",
        "description": "Path to the FFmpeg binary. Defaults to ffmpeg in PATH.",
        "type": "string",
        "default": "ffmpeg",
        "required": false
      },
      "ffmpegDebug": {
        "title": "FFmpeg Debug Logging",
        "description": "Log FFmpeg output for troubleshooting.",
        "type": "boolean",
        "default": false,
        "required": false
      },
      "debugStreamPath": {
        "title": "Debug Stream Recording Path",
        "description": "Path to save raw MPEG-TS stream recordings for debugging. Leave empty to disable.",
        "type": "string",
        "required": false,
        "placeholder": "/tmp/blink-streams"
      },
      "rtspTransport": {
        "title": "RTSP Transport",
        "description": "RTSP transport mode for Blink live view input.",
        "type": "string",
        "default": "tcp",
        "required": false,
        "oneOf": [
          { "title": "TCP (recommended)", "enum": ["tcp"] },
          { "title": "UDP", "enum": ["udp"] }
        ]
      },
      "maxStreams": {
        "title": "Max Concurrent Streams",
        "description": "Maximum number of simultaneous HomeKit streams.",
        "type": "integer",
        "default": 1,
        "minimum": 1,
        "maximum": 4,
        "required": false
      },
      "enableAudio": {
        "title": "Enable Audio",
        "description": "Enable audio streaming from camera to HomeKit.",
        "type": "boolean",
        "default": true,
        "required": false
      },
      "twoWayAudio": {
        "title": "Enable Two-Way Audio",
        "description": "Temporarily disabled: talkback UI is hidden until uplink framing is finalized.",
        "type": "boolean",
        "default": false,
        "required": false
      },
      "audioCodec": {
        "title": "Audio Codec",
        "description": "Preferred audio codec for HomeKit streaming.",
        "type": "string",
        "default": "opus",
        "required": false,
        "oneOf": [
          { "title": "Opus (recommended)", "enum": ["opus"] },
          { "title": "AAC-ELD", "enum": ["aac-eld"] },
          { "title": "PCMA", "enum": ["pcma"] },
          { "title": "PCMU", "enum": ["pcmu"] }
        ]
      },
      "audioBitrate": {
        "title": "Audio Bitrate (kbps)",
        "description": "Target audio bitrate for HomeKit streaming.",
        "type": "integer",
        "default": 32,
        "minimum": 8,
        "maximum": 128,
        "required": false
      },
      "videoBitrate": {
        "title": "Max Video Bitrate (kbps)",
        "description": "Cap the video bitrate (leave empty to use HomeKit defaults).",
        "type": "integer",
        "minimum": 300,
        "maximum": 8000,
        "required": false
      },
      "excludeDevices": {
        "title": "Excluded Devices",
        "description": "List of device serial numbers, IDs, or names to exclude from HomeKit.",
        "type": "array",
        "items": {
          "type": "string",
          "title": "Device Identifier"
        },
        "required": false
      },
      "deviceNameOverrides": {
        "title": "Custom Device Names",
        "description": "Override display names for devices in HomeKit.",
        "type": "array",
        "items": {
          "type": "object",
          "properties": {
            "deviceIdentifier": {
              "title": "Device Serial / ID",
              "description": "The device serial number or numeric ID to rename",
              "type": "string",
              "required": true
            },
            "customName": {
              "title": "Custom Name",
              "description": "The display name to use in HomeKit",
              "type": "string",
              "required": true
            }
          }
        },
        "required": false
      },
      "deviceSettingOverrides": {
        "title": "Per-Device Settings",
        "description": "Override settings for specific devices.",
        "type": "array",
        "items": {
          "type": "object",
          "properties": {
            "deviceIdentifier": {
              "title": "Device Serial / ID",
              "description": "The device serial number or numeric ID to configure",
              "type": "string",
              "required": true
            },
            "motionTimeout": {
              "title": "Motion Timeout (seconds)",
              "type": "integer",
              "minimum": 5,
              "maximum": 300,
              "description": "Motion timeout in seconds for this device"
            },
            "enableMotion": {
              "title": "Enable Motion Detection",
              "type": "boolean",
              "description": "Enable/disable motion detection for this device"
            }
          }
        },
        "required": false
      }
    }
  },
  "layout": [
    {
      "type": "fieldset",
      "title": "Platform Settings",
      "items": [
        "name",
        "tier"
      ]
    },
    {
      "type": "fieldset",
      "title": "Device Identification",
      "expandable": true,
      "expanded": false,
      "items": [
        "deviceId",
        "deviceName"
      ]
    },
    {
      "type": "fieldset",
      "title": "Polling & Snapshots",
      "expandable": true,
      "expanded": false,
      "items": [
        "pollInterval",
        "motionTimeout",
        "enableMotionPolling",
        "snapshotCacheTTL",
        "persistSnapshotCache"
      ]
    },
    {
      "type": "fieldset",
      "title": "Streaming",
      "expandable": true,
      "expanded": false,
      "items": [
        "enableStreaming",
        "ffmpegPath",
        "maxStreams",
        "enableAudio",
        "twoWayAudio",
        "audioCodec",
        "audioBitrate",
        "videoBitrate",
        "rtspTransport",
        "ffmpegDebug",
        "debugStreamPath"
      ]
    },
    {
      "type": "fieldset",
      "title": "Device Customization",
      "expandable": true,
      "expanded": false,
      "items": [
        {
          "key": "excludeDevices",
          "type": "array",
          "buttonText": "Add Device to Exclude",
          "items": [
            "excludeDevices[]"
          ]
        },
        {
          "key": "deviceNameOverrides",
          "type": "array",
          "buttonText": "Add Name Override",
          "items": [
            "deviceNameOverrides[].deviceIdentifier",
            "deviceNameOverrides[].customName"
          ]
        },
        {
          "key": "deviceSettingOverrides",
          "type": "array",
          "buttonText": "Add Device Setting",
          "items": [
            "deviceSettingOverrides[].deviceIdentifier",
            "deviceSettingOverrides[].motionTimeout",
            "deviceSettingOverrides[].enableMotion"
          ]
        }
      ]
    },
    {
      "type": "fieldset",
      "title": "Advanced",
      "expandable": true,
      "expanded": false,
      "items": [
        "persistAuth",
        "trustDevice",
        "authLocked",
        "debugAuth"
      ]
    }
  ]
}
